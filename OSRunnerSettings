--[[OSRunner Settings]]--
--[[Variables]]--
local w,h = term.getSize()
local curOS = 1

--[[Tables]]--
local ui = {
  {text = "Back",x = 4,x1 = 2,x2 = 9,y = 12,bgCol = colors.lightGray,col = colors.black,option = "back"},
	{text = "Next",x = 45,x1 = 43,x2 = 50,y = 12,bgCol = colors.lightGray,col = colors.black,option = "next"},
	{text = "Download OS",x = 4,x1 = 2,x2 = 17,y = 15,bgCol = colors.lightGray,col = colors.black,option = "download"},
	{text = "Launch OS",x = 22,x1 = 21,x2 = 31,y = 16,bgCol = colors.lightGray,col = colors.black,option = "launch"},
	{text = "System Settings",x = 2,x1 = 2,x2 = 17,y = 17,bgCol = colors.lightGray,col = colors.black,option = "settings"}
}
local osTable = {
	{text = "CraftOS",col = colors.yellow,option = "craftos"},
	{text = "KREOS",col = colors.blue,option = "kreos"},
	{text = "EnderOS",col = colors.purple,option = "enderos"}
}

--[[Functions]]--
local function centerPrint(text,line)
	term.setCursorPos((w-#text)/2,line)
	term.write(text)
end
local function redraw()
	local image = paintutils.loadImage("/.OSRunner/gui")
	paintutils.drawImage(image,1,1)
	term.setBackgroundColor(colors.red)
	term.setTextColor(colors.white)
	centerPrint("OSRunner Options",1)
	for k,v in pairs(ui) do
		term.setTextColor(v.col)
		term.setBackgroundColor(v.bgCol)
		term.setCursorPos(v.x,v.y)
		term.write(v.text)
	end
	term.setBackgroundColor(colors.lightGray)
	term.setTextColor(osTable[curOS].col)
	centerPrint(osTable[curOS].text,3)
end

local function getImageFile()
	if not fs.exists("/.OSRunner/gui") then
		local response = http.get("https://raw.github.com/MudkipTheEpic/ComputerCraft/master/OSRunnerSettingsImage")
		if not response then
			return error("An error has occurred while downloading /.OSRunner/gui")
		else
			local data  = {}
			local sResponse = response.readLine()
			for sResponse in response.readLine do
				table.insert(data,sResponse)
			end
			response.close()
			local handle = fs.open("/.OSRunner/gui","w")
			for i = 1,#data do
				handle.writeLine(data[i])
			end
			handle.close()
		end
	end
end

--[[Main Program]]--
getImageFile()
while true do
	redraw()
	local _,p1,xPos,yPos = os.pullEvent("mouse_click")
	if p1 == 1 then
		for k,v in pairs(ui) do
			if(xPos >= v.x1 and xPos <= v.x2 and yPos == v.y) then
				if v.option == "back" and (curOS-1) > 0 then
					curOS = (curOS-1)
				elseif v.option == "next" and #osTable >= (curOS+1) then
					curOS = (curOS+1)
				end
			end
		end
	end
end
